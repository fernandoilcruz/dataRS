right = TRUE
)
),
color = "lightgray",
size = 0.15
) +
labs(
title = "Var. % do Rendimento Médio da Produção de Soja",
caption = "Fonte: DataRS",
fill = "Var. % do Rendimento"
) +
scale_fill_manual(
values = c(
"< -25%" = "#A6D96A",
"-25% to 0%" =  "#FFFFBF",
"0% to 25%" = "#FDAE61",
"> 25%" = "#D7191C"
),
na.value = "gray95"
) +
gganimate::transition_manual(year) +
labs(title = "Ano: {current_frame}")
p_anim1 <- animate(p_map1,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
rend_estado <-
data_soy_state |>
ggplot(
aes(x = year,
y = `percent change`
)
) +
geom_line(colour = "darkblue",
alpha = 0.5,
size = 1) +
geom_point(colour = "darkblue") +
ggtitle("Rendimento da produção de soja no Rio Grande do Sul") +
gganimate::transition_reveal(year) +
theme_minimal()
p_anim2 <- animate(rend_estado,
nframes = 31,
#nframes = 500,
#duration = 20,
renderer = gifski_renderer())
a_mgif <- image_read(p_anim1)
b_mgif <- image_read(p_anim2)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]), stack = FALSE)
for(i in 2:31){
combined <- image_append(c(a_mgif[i], b_mgif[i]), stack = FALSE)
new_gif <- c(new_gif, combined)
}
new_gif
p_map1 <-
map_rs |>
ggplot() +
geom_sf(
aes(
fill = cut(
`percent change`,
breaks = c(-Inf, -25, 0, 25, Inf),
labels = c("< -25%", "-25% a 0%", "0% a 25%", "> 25%"),
right = TRUE
)
),
color = "lightgray",
size = 0.15
) +
labs(
title = "Var. % do Rendimento Médio da Produção de Soja",
caption = "Fonte: DataRS",
fill = "Var. % do Rendimento"
) +
scale_fill_manual(
values = c(
"> 25%" = "#A6D96A",
"0% a 25%" =  "#FFFFBF",
"-25% a 0%" = "#FDAE61",
"< -25%" = "#D7191C"
),
na.value = "gray95"
) +
gganimate::transition_manual(year) +
labs(title = "Ano: {current_frame}") +
theme_minimal()
p_anim1 <- animate(p_map1,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
rend_estado <-
data_soy_state |>
ggplot(
aes(x = year,
y = `percent change`
)
) +
geom_line(colour = "darkblue",
alpha = 0.5,
size = 1) +
geom_point(colour = "darkblue") +
ggtitle("Rendimento da produção de soja no Rio Grande do Sul") +
gganimate::transition_reveal(year) +
theme_minimal()
p_anim2 <- animate(rend_estado,
nframes = 31,
#nframes = 500,
#duration = 20,
renderer = gifski_renderer())
a_mgif <- image_read(p_anim1)
b_mgif <- image_read(p_anim2)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]), stack = FALSE)
for(i in 2:31){
combined <- image_append(c(a_mgif[i], b_mgif[i]), stack = FALSE)
new_gif <- c(new_gif, combined)
}
new_gif
install.packages("forcats")
p_map1 <-
map_rs |>
ggplot() +
geom_sf(
aes(
fill =
cut(
`percent change`,
breaks = c(-Inf, -25, 0, 25, Inf),
labels = c("< -25%", "-25% a 0%", "0% a 25%", "> 25%"),
right = TRUE
) |>
forcats::fct_rev()
),
color = "lightgray",
size = 0.15
) +
labs(
title = "Var. % do Rendimento Médio da Produção de Soja",
caption = "Fonte: DataRS",
fill = "Var. % do Rendimento"
) +
scale_fill_manual(
values = c(
"> 25%" = "#A6D96A",
"0% a 25%" =  "#FFFFBF",
"-25% a 0%" = "#FDAE61",
"< -25%" = "#D7191C"
),
na.value = "gray95"
) +
gganimate::transition_manual(year) +
labs(title = "Ano: {current_frame}") +
theme_minimal()
p_anim1 <- animate(p_map1,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
rend_estado <-
data_soy_state |>
ggplot(
aes(x = year,
y = `percent change`
)
) +
geom_line(colour = "darkblue",
alpha = 0.5,
size = 1) +
geom_point(colour = "darkblue") +
ggtitle("Rendimento da produção de soja no Rio Grande do Sul") +
gganimate::transition_reveal(year) +
theme_minimal()
p_anim2 <- animate(rend_estado,
nframes = 31,
#nframes = 500,
#duration = 20,
renderer = gifski_renderer())
a_mgif <- image_read(p_anim1)
b_mgif <- image_read(p_anim2)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]), stack = FALSE)
for(i in 2:31){
combined <- image_append(c(a_mgif[i], b_mgif[i]), stack = FALSE)
new_gif <- c(new_gif, combined)
}
new_gif
data_soy_state
rend_estado <-
data_soy_state |>
ggplot(
aes(x = year,
y = `percent change`
)
) +
geom_line(colour = "darkblue",
alpha = 0.5,
size = 1) +
geom_point(colour = "darkblue") +
ggtitle("Rendimento da produção de soja no Rio Grande do Sul") +
gganimate::transition_reveal(year) +
theme_minimal()
rend_estado
data_soy_state |>
ggplot(
aes(x = year,
y = `percent change`
)
) +
geom_line(colour = "darkblue",
alpha = 0.5,
size = 1) +
geom_point(colour = "darkblue") +
ggtitle("Rendimento da produção de soja no Rio Grande do Sul") +
gganimate::transition_reveal(year) +
theme_minimal()
p_anim2 <- animate(rend_estado,
#nframes = 31,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
p_anim2
new_gif <- image_append(c(a_mgif[1], b_mgif[1]), stack = FALSE)
for(i in 2:500){
combined <- image_append(c(a_mgif[i], b_mgif[i]), stack = FALSE)
new_gif <- c(new_gif, combined)
}
a_mgif
b_mgif
p_map1 <-
map_rs |>
ggplot() +
geom_sf(
aes(
fill =
cut(
`percent change`,
breaks = c(-Inf, -25, 0, 25, Inf),
labels = c("< -25%", "-25% a 0%", "0% a 25%", "> 25%"),
right = TRUE
) |>
forcats::fct_rev()
),
color = "lightgray",
size = 0.15
) +
labs(
title = "Var. % do Rendimento Médio da Produção de Soja",
caption = "Fonte: DataRS",
fill = "Var. % do Rendimento"
) +
scale_fill_manual(
values = c(
"> 25%" = "#A6D96A",
"0% a 25%" =  "#FFFFBF",
"-25% a 0%" = "#FDAE61",
"< -25%" = "#D7191C"
),
na.value = "gray95"
) +
gganimate::transition_manual(year) +
labs(title = "Ano: {current_frame}") +
theme_minimal()
p_anim1 <- animate(p_map1,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
rend_estado <-
data_soy_state |>
ggplot(
aes(x = year,
y = `percent change`
)
) +
geom_line(colour = "darkblue",
alpha = 0.5,
size = 1) +
geom_point(colour = "darkblue") +
ggtitle("Rendimento da produção de soja no Rio Grande do Sul") +
gganimate::transition_reveal(year) +
theme_minimal()
p_anim2 <- animate(rend_estado,
#nframes = 31,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
a_mgif <- image_read(p_anim1)
b_mgif <- image_read(p_anim2)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]), stack = FALSE)
for(i in 2:500){
combined <- image_append(c(a_mgif[i], b_mgif[i]), stack = FALSE)
new_gif <- c(new_gif, combined)
}
rm(list=ls())
library(dataRS)
library(devtools)
load_all()
geoagregall2()
help(geoagregall2)
help(geoagregall2, period = 2022)
help(geoagregall2, period = 2010)
geoagregall2(period = 2010)
geoagregall2(period = 2022)
geoagregall2(period = 2022) |> View()
library(tidyverse)
df0 <-
readxl::read_excel("C:\\Users\\fernando-cruz\\Downloads\\S1.1.xlsx")
df0
readxl::read_excel("C:\\Users\\fernando-cruz\\Downloads\\S1.1.xlsx") |>
save("data/geo_complement.rda")
readxl::read_excel("C:\\Users\\fernando-cruz\\Downloads\\S1.1.xlsx") |>
save("data/geo_complement.rda", compress = "bzip2")
usethis::use_data_raw()
rm(list=ls())
## code to prepare `DATASET` dataset goes here
geo_complement <-
readxl::read_excel("C:\\Users\\fernando-cruz\\Downloads\\S1.1.xlsx")
usethis::use_data(DATASET, overwrite = TRUE)
## code to prepare `DATASET` dataset goes here
geo_complement <-
readxl::read_excel("C:\\Users\\fernando-cruz\\Downloads\\S1.1.xlsx")
usethis::use_data(geo_complement, overwrite = TRUE)
usethis::use_r("geo_complement")
geo_complement
devtools::document()
?geo_complement
document()
?geo_complement
## code to prepare `DATASET` dataset goes here
geo_complement <-
readxl::read_excel(".data-raw\\S1.1.xlsx")
## code to prepare `DATASET` dataset goes here
geo_complement <-
readxl::read_excel(".\\data-raw\\S1.1.xlsx")
usethis::use_data(geo_complement, overwrite = TRUE)
document()
library(devtools)
load_all()
#Installation from github
library(devtools)
#devtools::install_github("fernandoilcruz/dataRS")
#Load the package
library(dataRS)
my_vars <-
dataRS::vars() |>
dplyr::filter(stringr::str_detect(var_name,"RIPSA")) |>
dplyr::select(var_id) |>
dplyr::pull()
my_geo <-
dataRS::geoagreg(ag = "corede") |>
dplyr::filter(stringr::str_detect(geo_name,"Hortênsias") | stringr::str_detect(geo_name,"Metropolitano")) |>
dplyr::select(geo_id) |>
dplyr::pull()
my_vars |>
purrr::set_names() |>
purrr::map(
function(x){
dataRS::available(x, ag = "corede")
}
)
my_data <-
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
my_data <-
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
library(dataRS)
library(tidyverse)
library(geobr)
library(gganimate)
library(magick)
soy_id <-
dataRS::vars() |>
dplyr::filter(stringr::str_detect(var_name,"Soja") & stringr::str_detect(var_name,"Rendimento")) |>
dplyr::select(var_id) |>
dplyr::pull()
data_soy_mun <-
dataRS::getdata(var_id = soy_id,
ag = "municipio",
period = "all",
add_labels = TRUE) |>
group_by(geo_id) |>
dplyr::mutate(
`percent change` = 100*((value-dplyr::lag(value))/(dplyr::lag(value)))
)
data_soy_mun
soy_id
data_soy_mun <-
dataRS::getdata(var_id = soy_id,
ag = "municipio",
period = "all",
add_labels = TRUE)
data_soy_mun
remove.packages("dataRS")
document()
data_soy_mun <-
getdata(var_id = soy_id,
ag = "municipio",
period = "all",
add_labels = TRUE)
data_soy_mun
options(scipen = 99999)
options(scipen = 999)
data_soy_mun
data_soy_mun <-
getdata(var_id = soy_id,
ag = "municipio",
period = "all",
add_labels = TRUE)
data_soy_mun
document()
library(dataRS)
soy_id <-
dataRS::vars() |>
dplyr::filter(stringr::str_detect(var_name,"Soja") & stringr::str_detect(var_name,"Rendimento")) |>
dplyr::select(var_id) |>
dplyr::pull()
data_soy_mun <-
dataRS::getdata(var_id = soy_id,
ag = "municipio",
period = "all",
add_labels = TRUE) |>
group_by(geo_id) |>
dplyr::mutate(
`percent change` = 100*((value-dplyr::lag(value))/(dplyr::lag(value)))
)
data_soy_state <-
dataRS::getdata(var_id = soy_id,
ag = "estado",
period = "all",
add_labels = TRUE) |>
group_by(geo_id) |>
dplyr::mutate(
`percent change` = 100*((value-dplyr::lag(value))/(dplyr::lag(value)))
)
map_rs_mapa <-
geobr::read_municipality(
code_muni = "RS",
year = 2020
)
anos <- data_soy_mun |> select(year) |> pull() |> unique()
lista <- list()
for(i in 1:length(anos)){
lista[[i]] <-
map_rs_mapa |>
mutate(year = anos[i])
}
map_rs_mapa2 <- lista |> map_df(bind_rows)
map_rs <-
map_rs_mapa2 |>
dplyr::left_join(
data_soy_mun,
by = c("code_muni" = "geo_id",
"year" = "year")
)
p_map1 <-
map_rs |>
ggplot() +
geom_sf(
aes(
fill =
cut(
`percent change`,
breaks = c(-Inf, -25, 0, 25, Inf),
labels = c("< -25%", "-25% a 0%", "0% a 25%", "> 25%"),
right = TRUE
) |>
forcats::fct_rev()
),
color = "lightgray",
size = 0.15
) +
labs(
title = "Var. % do Rendimento Médio da Produção de Soja",
caption = "Fonte: DataRS",
fill = "Var. % do Rendimento"
) +
scale_fill_manual(
values = c(
"> 25%" = "#A6D96A",
"0% a 25%" =  "#FFFFBF",
"-25% a 0%" = "#FDAE61",
"< -25%" = "#D7191C"
),
na.value = "gray95"
) +
gganimate::transition_manual(year) +
labs(title = "Ano: {current_frame}") +
theme_minimal()
p_anim1 <- animate(p_map1,
nframes = 500,
#duration = 20,
renderer = gifski_renderer())
p_anim1
rm(list=ls())
dataRS::geo_complement()
data("geo_complement")
geo_complement
DOCUMENT()
document()
check()
document()
check()
rm(list=ls())
document()
document()
library(devtools)
document()
document()
## Update data-raw when including new regionalization
geo_complement <-
readxl::read_excel(".\\data-raw\\geo_complement.xlsx")
usethis::use_data(geo_complement, overwrite = TRUE)
source("data-raw/mydata.R")
names(geo_complement)
document()
library(devtools)
document()
rm(list=ls())
