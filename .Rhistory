}
geo_id=my_geo
if(is.null(geo_id)){
x<-
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",
z,
"&ag=",
ag,
"&periodo=",
period |> paste0(collapse = ","),
"&sort=",
sort,
"&formato=json",
"&use_ibge_code=","1"
) |>
httr::GET(timeout(1000000), config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tidyr::unnest(cols = data) |>
dplyr::mutate(var_id = z)
})
}else{
x<-
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
) |>
httr::GET(timeout(1000000), config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tidyr::unnest(cols = data) |>
dplyr::mutate(var_id = z)
})
}
rm(list=ls())
my_vars <-
dataRS::vars() |>
dplyr::filter(stringr::str_detect(var_name,"RIPSA")) |>
dplyr::select(var_id) |>
dplyr::pull()
my_geo <-
dataRS::geoagreg(ag = "corede") |>
dplyr::filter(stringr::str_detect(geo_name,"Hortênsias") | stringr::str_detect(geo_name,"Metropolitano")) |>
dplyr::select(geo_id) |>
dplyr::pull()
my_vars |>
purrr::set_names() |>
purrr::map(
function(x){
dataRS::available(x, ag = "corede")
}
)
my_data <-
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
ag="corede"
my_vars <- my_vars[1:3]
sort = "ASC"
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
)
})
var_id <- my_vars
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
)})
period="all"
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
)})
geo_id=my_geo
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
)})
var_id |>
purrr::map(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
)})
var_id |>
purrr::map(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
) |>
httr::GET(timeout(1000000), config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tidyr::unnest(cols = data) |>
dplyr::mutate(var_id = z)
})
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
) |>
httr::GET(timeout(1000000), config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tidyr::unnest(cols = data) |>
dplyr::mutate(var_id = z)
})
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
) |>
httr::GET(timeout(1000000), config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tidyr::unnest(cols = data) |>
dplyr::mutate(var_id = z)
})
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
geo_id
getdata(var_id = 4603,geo_id = 2, ag = "corede",period = "all")
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = FALSE)
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
var_id |>
purrr::map_df(function(z){
paste0(get_url(info = "data"),
"&id=",z,
"&ag=",ag,
"&periodo=",period |> paste0(collapse = ","),
"&filtro=",geo_id |> paste0(collapse = ","),
"&sort=",sort,
"&formato=json",
"&use_ibge_code=","1"
) |>
httr::GET(timeout(1000000), config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tidyr::unnest(cols = data) |>
dplyr::mutate(var_id = z)
})
getdata(var_id = 4603,ag = "corede",period = c(2016,2017), add_labels = TRUE, var_name_break = FALSE)
getdata(var_id = 4603,ag = "corede",period = c(2016,2017), add_labels = TRUE, var_name_break = FALSE)
document()
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = FALSE)
document()
rm(list=ls())
my_vars <-
dataRS::vars() |>
dplyr::filter(stringr::str_detect(var_name,"RIPSA")) |>
dplyr::select(var_id) |>
dplyr::pull()
my_geo <-
dataRS::geoagreg(ag = "corede") |>
dplyr::filter(stringr::str_detect(geo_name,"Hortênsias") | stringr::str_detect(geo_name,"Metropolitano")) |>
dplyr::select(geo_id) |>
dplyr::pull()
my_vars |>
purrr::set_names() |>
purrr::map(
function(x){
dataRS::available(x, ag = "corede")
}
)
dataRS::getdata(var_id = my_vars, ag = "corede", geo_id = my_geo, period = "all", add_labels = TRUE)
library(devtools)
load_all()
devtools::build()
document()
devtools::build()
document()
devtools::build()
document()
devtools::build()
#From github
library(devtools)
#devtools::install_github("fernandoilcruz/dataRS")
library(dataRS)
my_key <- Sys.getenv("MY_API_KEY")
dataRS::set_api_key(key = my_key)
my_key <- Sys.getenv("MY_API_KEY")
dataRS::set_api_key(key = my_key)
library(devtools)
load_all()
devtools::build()
check()
library(devtools)
load_all()
devtools::build()
devtools::check()
Sys.time()
my_data <- getdata(var_id = 4603, ag = "estado",period = "all")
my_data
my_data <- getdata(var_id = 4603, ag = "corede",period = "all")
my_data
document()
check()
document()
check()
rm(list=ls())
library(devtools)
check()
document()
check()
document()
check()
document()
check()
document()
library(devtools)
load_all()
document()
library(devtools)
load_all()
library(devtools)
load_all()
document()
library(devtools)
load_all()
document()
library(devtools)
load_all()
document()
library(devtools)
load_all()
document()
library(devtools)
load_all()
ag = "municipio"
sort = "ASC"
url <-
paste0(
get_url(info = "ag"),
"&ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url
load_all()
document()
url <-
paste0(
get_url(info = "ag"),
"&ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url
library(devtools)
load_all()
ag = "municipio"
sort = "ASC"
url <-
paste0(
get_url(info = "ag"),
"&ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
#output
x <-
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tibble::as_tibble() |>
dplyr::rename("geo_id" = "id",
"geo_name" = "nome")
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tibble::as_tibble()
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
get_api_key()
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
get_api_key()
help(httr::GET)
help(GET)
x <-
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
x
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key())
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
get_api_key()
x$request
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key() |> as.character()),
config = config(ssl_verifypeer = 0))
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key() |> as.character()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
get_api_key()
document()
url
library(devtools)
load_all()
ag = "municipio"
sort = "ASC"
url <-
paste0(
get_url(info = "ag"),
"&ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url
get_url(info = "ag")
paste0(
get_url(info = "ag"),
"ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url <-
paste0(
get_url(info = "ag"),
"ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
url
get_api_key()
x$request
x <-
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
x$request
x
x$request
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
x <-
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0))
x$request
document()
load_all()
url <-
paste0(
get_url(info = "ag"),
"&ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
url
document()
load_all()
url <-
paste0(
get_url(info = "ag"),
"&ag=",ag,
"&sort=",sort,
"&use_ibge_code=","1"
)
url
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8")
vars()
document()
load_all()
vars()
get_url(info = "var_list")
get_url(info = "var_list")
geoagreg()
get_url(info = "var_list")
# Construct URL
base_url <- get_url(info = "var_list")
if (!is.null(sort)) {
url <- paste0(base_url, "&sort=", sort)
} else {
url <- base_url
}
url
url |>
jsonlite::fromJSON()
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON()
res <-
url |>
httr::GET(timeout(1000000),
add_headers("Integra-Key" = get_api_key()),
config = config(ssl_verifypeer = 0)) |>
content("text", encoding = "UTF-8") |>
jsonlite::fromJSON() |>
tibble::as_tibble()
res
document()
load_all()
